{% extends "base.html" %}
{% load static%}

{% block title %}Address - HireMe{% endblock %}

{% block css_files %}
<link rel="stylesheet" href="{% static 'css/clientprofile/sidebar.css' %}">
<link rel="stylesheet" href="{% static 'css/clientprofile/editaddress.css' %}">
{% endblock %}

{% block content %}
{% include 'clientprofile/sidebar.html' %}

<!-- Loading Screen -->
<div id="loading-screen" style="display: none;">
    <div class="spinner"></div>
</div>

<!-- Address and City Information -->
<div class="edit-address-container">
    <div class="back-button">
        <a href="{% url 'client:profile' %}">
            <i class="fa fa-arrow-left"></i> Back
        </a>
    </div>
    <div class="edit-address-form" id="edit-profile-form">
        <form action="{% url 'client:edit-address' %}" method="POST">
            {% csrf_token %}
            <div class="form-group">
                <label for="country">Country</label>
                <select id="country" name="country">
                    <option value="">Select a country</option>
                    {% for country, cities in countries_and_cities.items %}
                        <option value="{{ country }}" {% if client.country == country %}selected{% endif %}>
                            {{ country }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="city">City</label>
                <select id="city" name="city" >
                    <option value="">Select a city</option>
                    {% if client.city %}
                        <option value="{{ client.city }}" selected>{{ client.city }}</option>
                    {% endif %}
                </select>
            </div>
            <div class="form-actions">
                <button type="submit" class="save-btn">Save Changes</button>
                <a href="{% url 'client:profile' %}" id="cancel-edit" class="cancel-btn">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block footer %}
{% endblock %}

{% block js_files %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const countrySelect = document.getElementById("country");
        const citySelect = document.getElementById("city");

        const citiesByCountry = {{ countries_and_cities_json|safe }};
        
        function populateCities(country) {
            citySelect.innerHTML = "<option value=''>Select a city</option>";
            if (citiesByCountry[country]) {
                citiesByCountry[country].forEach(city => {
                    const option = document.createElement("option");
                    option.value = city;
                    option.textContent = city;
                    if (city === "{{ client.city }}") {
                        option.selected = true;
                    }
                    citySelect.appendChild(option);
                });
            }
        }

        const preSelectedCountry = countrySelect.value;
        if (preSelectedCountry) {
            populateCities(preSelectedCountry);
        }

        countrySelect.addEventListener("change", function () {
            const selectedCountry = this.value;
            populateCities(selectedCountry);
        });
    });
</script>
{% endblock %}
