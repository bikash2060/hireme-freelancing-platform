{% extends "base.html" %}
{% load static%}

{% block title %}Account Settings - HireMe{% endblock %}

{% block css_files %}
<link rel="stylesheet" href="{% static 'css/freelancerprofile/profile.css' %}">
<link rel="stylesheet" href="{% static 'css/freelancerprofile/sidebar.css' %}">
{% endblock %}

{% block content %}
{% include 'freelancerprofile/sidebar.html' %}

<!-- Loading Screen Section -->
<div id="loading-screen" style="display: none;">
    <div class="spinner"></div>
</div>

<!-- User Profile Section -->
<div class="user-basic-info">
    <div class="settings-container">
        <p class="title">My Profile</p>

        <!-- Profile Image and Username Information Section -->
        <div class="profile-info">
            <div class="box">
                <div class="left-side">
                    <img src="{% if user.profile_image %}{% get_media_prefix %}profile_images/{{ user.profile_image }}{% else %}{% static 'images/default-user-pic.png' %}{% endif %}" alt="Profile Image">
                    <div class="details">
                        {% if user.first_name and user.last_name %}
                            <p class="name">{{ user.first_name }} {{ user.last_name }}</p>
                        {% endif %}
                        <p class="position">{{user.username}}</p>
                        {% if freelancer.city and freelancer.country %}
                            <p class="address">{{freelancer.city|add:", "}}{{freelancer.country}}</p>
                        {% endif %}
                    </div>
                </div>
                <div class="right-side">
                    <a href="{% url 'freelancer:edit-profile-image' %}" class="edit-link">Edit <i class="fa-solid fa-pen-to-square"></i></a>
                </div>                
            </div>            
        </div>
        
        <!-- Personal Information Section -->
        <div class="personal-info">
            <div class="box">
                <div class="header">
                    <p class="caption"><i class="fa-regular fa-id-card"></i>Personal Information</p>
                    <a href="{% url 'freelancer:edit-personal-info' %}" class="edit-link">Edit <i class="fa-solid fa-pen-to-square"></i></a>
                </div>
                <div class="body-content">
                    <div class="col-1">
                        <p><strong>First Name</strong></p>
                        <p>{{ user.first_name|default:"Not Provided" }}</p>
                    </div>
                    <div class="col-3">
                        <p><strong>Last Name</strong></p>
                        <p>{{ user.last_name|default:"Not Provided" }}</p>
                    </div>
                    <div class="col-3">
                        <p><strong>Email Address</strong> 
                            <button class="toggle-btn" onclick="toggleVisibility('email', this)">Unhide</button>
                        </p>
                        <p id="email">{{ user.email }}</p>
                    </div>
                    <div class="col-4">
                        <p><strong>Phone</strong> 
                            <button class="toggle-btn" onclick="toggleVisibility('phone', this)">Unhide</button>
                        </p>
                        <p id="phone">{{ user.phone_number|default:"No Phone Number Added" }}</p>
                    </div>                                    
                    <div class="col-6">
                        <p><strong>Languages</strong></p>
                        <p>{{ freelancer.languages|default:"Not Specified"}}</p>
                    </div>                                                          
                    <div class="col-7">
                        <p><strong>Bio</strong></p>
                        <p id="bio" class="bio-text">
                            {{ freelancer.bio|default:"No bio available. Add a short description about yourself!" }}
                        </p> 
                        <a href="javascript:void(0);" id="read-more" class="read-more" style="display: none;">Read More</a>
                    </div>
                </div>                
            </div>
        </div>

        <!-- Address Information Section -->
        <div class="addreess-info">
            <div class="box">
                <div class="header">
                    <p class="caption"><i class="fa-solid fa-location-dot"></i>Address</p>
                    <a href="{% url 'freelancer:edit-address' %}" class="edit-link">Edit <i class="fa-solid fa-pen-to-square"></i></a>
                </div>
                <div class="body-content">
                    <div class="col-1">
                        <p><strong>Country</strong></p>
                        <p>{{ freelancer.country|default:"Country Not Specified" }}</p>
                    </div>
                    <div class="col-2">
                        <p><strong>City</strong></p>
                        <p>{{ freelancer.city|default:"City Not Specified" }}</p>
                    </div>
                </div>
                
            </div>
        </div>

        <!-- Skills and Hourly Rate Information Section -->
        <div class="experience-info">
            <div class="box">
                <div class="header">
                    <p class="caption"><i class="fa-solid fa-briefcase"></i>Skills &amp; Hourly Rate</p>
                    <a href="{% url 'freelancer:edit-skill' %}" class="edit-link">Edit <i class="fa-solid fa-pen-to-square"></i></a>
                </div>
                <div class="body-content">
                    <div class="col-1">
                        <p><strong>Experience</strong></p>
                        <p>{{ experience_display }}</p>
                    </div>                
                    <div class="col-2">
                        <p><strong>Hourly Rate</strong></p>
                        <p>Rs. {{freelancer.hourly_rate|floatformat:2|default:"Not Provided"}}</p> 
                    </div>
                    <div class="col-3">
                        <p><strong>Skills</strong></p>
                        <div class="skills-list">
                            {% if freelancer.skills.all %}
                                {% for skill in freelancer.skills.all %}
                                    <span class="skill-tag">{{ skill.name }}</span>
                                {% endfor %}
                            {% else %}
                                <p>Not Provided</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>             

        <!-- Education Information Section -->
        <div class="education-info">
            <div class="box">
                <div class="header">
                    <p class="caption"><i class="fas fa-graduation-cap"></i> Education</p>
                    <a href="{% url 'freelancer:add-new-education' %}" class="add-link">Add <i class="fas fa-plus"></i></a>
                </div>
                <div class="body-content">
                    {% for education_info in educations_with_duration %}
                    <div class="education-item">
                        <div class="education-logo">
                            <img src="{% if education_info.education.logo %}{% get_media_prefix %}education_images/{{ education_info.education.logo }}{% else %}{% static 'images/default_institution_logo.png' %}{% endif %}" alt="{{ education_info.education.institution }} Logo">
                        </div>
                        <div class="education-details">
                            <p class="institution">{{ education_info.education.institution }}</p>
                            <p class="degree">{{ education_info.education.education_level|capfirst }}</p>
                            <p class="duration">
                                {% if education_info.education.end_date %}
                                    {{ education_info.education.start_date|date:"M Y" }} - {{ education_info.education.end_date|date:"M Y" }}
                                {% else %}
                                    {{ education_info.education.start_date|date:"M Y" }} - Present
                                {% endif %}
                            </p>
                            <p class="location">{{ education_info.education.location }}</p>
                        </div>
                        <a href="{% url 'freelancer:edit-education' education_info.education.id %}" class="edit-icon" title="Edit"><i class="fa-solid fa-pen-to-square"></i></a>
                        <a href="{% url 'freelancer:delete-education' education_info.education.id %}" class="delete-icon" title="Delete" onclick="return confirm('Are you sure you want to delete this education?')"><i class="bx bx-trash"></i></a>
                    </div>
                    {% empty %}
                        <p>No education records yet.</p>
                    {% endfor %}
                </div>
                
            </div>
        </div>
        
        <!-- Certificate Information Section -->
        <div class="certificate-info">
            <div class="box">
                <div class="header">
                    <div class="caption">
                        <i class="fas fa-award"></i> Certificates
                    </div>                    
                    <a href="{% url 'freelancer:add-new-certificate' %}" class="add-link">
                        Add<i class="fas fa-plus"></i>
                    </a>
                </div>
        
                {% for certificate in certificates %}
                <div class="certificate-item">
                    <div class="certificate-logo">
                        <img src="{% if certificate.certificate_logo %}{% get_media_prefix %}certificate_images/{{ certificate.certificate_logo }}{% else %}{% static 'images/default_certificate.jpg' %}{% endif %}" alt="{{ certificate.certificate_logo }} Logo">
                    </div>
        
                    <div class="certificate-details">
                        <div class="certificate-name">{{ certificate.certificate_name }}</div>
                        <div class="certificate-provider">{{ certificate.certificate_provider }}</div>
                        <div class="issued-date">Issued {{ certificate.issued_date|date:"M Y" }}</div>
                        {% if certificate.certificate_url%}
                            <div class="certificate-url">
                                <a href="{{ certificate.certificate_url }}" target="_blank">
                                    Show Credential <i class="fas fa-external-link-alt"></i>
                                </a>
                            </div>
                        {% endif %}
                    </div>
        
                    <a href="{% url 'freelancer:edit-certificate' certificate.id %}" class="edit-icon" title="Edit">
                        <i class="fa-solid fa-pen-to-square"></i>
                    </a>
                    <a href="{% url 'freelancer:delete-certificate' certificate.id %}" title="Delete" class="delete-icon" onclick="return confirm('Are you sure you want to delete this certificate?')"><i class="bx bx-trash"></i></a>
                </div>
                {% empty %}
                    <p>No certificates added yet.</p>
                {% endfor %}
            </div>
        </div>
        
    </div>
</div>

{% endblock %}

{% block footer %}
{% endblock %}

{% block js_files %}
<script src="{% static 'js/freelancerprofile/profile-utils.js' %}"></script>
{% endblock %}